https://docs.google.com/document/d/1I01GtuKguWxCq1OCHy_Uzgun-8tANGPudcNso839Bng/edit#

**Задание на разработку конструктора MDX запросов.**

MDX – это язык запросов к многомерным данным OLAP кубов. Не путать с SQL.

Необходимо разработать конструктор на PHP, который в результате должен возвращать текст MDX запроса. В конструкторе должна быть возможность применять выражения MDX и функции MDX, описанные ниже по тексту.

Никакого UI здесь нет, это должен быть чисто бэкенд.
Желательно скрипты разработать с перспективой расширения возможностей. Например добавление новых функций и/или выражений MDX.
Текст MDX запроса, возвращаемый конструктором, не обязан содержать переносы строк и табуляции как показано в примерах.

Для выполнения задания не нужно изучать всё по OLAP и MDX. Достаточно информации далее.
Структура MDX запроса

WITH ...

SELECT 

… ON COLUMNS,

… ON ROWS 

FROM …


WITH — Ключевое слово, объявляющее вычисляемые элементы. В нашем конструкторе предполагается, что в этом блоке может содержаться любое произвольное строковое выражение. WITH может отсутствовать в запросе.

FROM — Это указание куба из которого производится выборка данных. Также здесь можно указать другой MDX запрос в котором можно указать другой запрос и т.д. каскад до названия куба. FROM обязательно должен присутствовать в запросе.

SELECT — Инструкция, которая определяет какие данные будут в колонках и строках. В запросе обязательно должна присутствовать инструкция SELECT, но не обязательно указывать и колонки и строки одновременно.
В ON COLUMNS и ON ROWS содержатся выражения MDX запроса (измерения, меры, наборы(Set), кортежи(Tuple) и функции), которые определяют как расположить данные в результирующей таблице.

Куб (Cube) — часть данных сервера анализа, с которой осуществляется работа. Куб представлен набором мер и измерений. Название куба в MDX указывается в квадратных скобках. Например [Sales].


**Выражения MDX запроса**

Мера, измерение и элемент (Member_expression) 
Параметры данных куба.

Внимание! Для простоты понимания и выполнения тестового задания, за выражение Меры, Измерения или Элемента можно считать произвольную строку, заключенную в квадратные скобки. 
Измерение может иметь иерархическую структуру уровней. В частности, измерение «Время» может включать уровни Год, Квартал, Месяц, Число, а измерение «География» может включать уровни Весь мир, Страна, Город, Улица.
Элемент  — это единица на каждом уровне иерархии измерения. Например, для измерения География. На уровне городов это — Москва, Санкт-Петербург, т.д. На уровне страны – это Россия, Казахстан и т.д.

В MDX запросе выражение меры, измерения или элемента указываются в квадратных скобках.
Например:

Измерения: [Date].[Date].[Month] или [Good].[Good].[GoodName]

Меры: [Measures].[Amount]

Элементы: [Good].[Good].[GoodName].&[Футболка синяя] или [Date].[Date].[Month].&[202101] или [Date].[Date].[Day].&[20210115]

В конструктор MDX запросов так и должны добавляться как указано в примерах. Иерархия измерений никак не должна проверяться.


**Кортеж (Tuple) (Tuple_expression)**

Список элементов измерений, кортеж включает по одному элементу из каждого измерения, содержащегося в кубе. Выражение кортежа в MDX запросе указывается через круглые скобки, а элементы перечисляются через запятую.


Синтаксис:

(Member_expression [,Member_expression ...])


Например: ([Good].[Good].[GoodName].&[Футболка синяя], [Date].[Date].[Month].&[202101]).

Кортеж из одного элемента может не заключаться в круглые скобки.


**Набор (Set) (Set_expression)**

Список мер, измерений или кортежей(Tuple). Выражение набора в MDX запросе указывается через фигурные скобки.

Синтаксис:

{[{ Tuple_expression  |  Member_expression } [, { Tuple_expression  |  Member_expression }]...]}


Пример 1 – набор из двух измерений: 
{[Measures].[Internet Sales Amount], [Measures].[Internet Tax Amount]}


Пример 2 – набор из трех кортежей:
{([Product].[Product Categories].[Category].&[4], [Date].[Calendar].[Calendar Year].&[2004]), ([Product].[Product Categories].[Category].&[1], [Date].[Calendar].[Calendar Year].&[2003]), ([Product].[Product Categories].[Category].&[3], [Date].[Calendar].[Calendar Year].&[2004])}
Набор из одного элемента может не заключаться в фигурные скобки.
